document.observe("click",function(t,e){if(e=t.findElement("form a.add_nested_fields")){var n=e.readAttribute("data-association"),s=e.readAttribute("data-target"),o=$(e.readAttribute("data-blueprint-id")),r=o.readAttribute("data-blueprint"),a=(e.getOffsetParent(".fields").firstDescendant().readAttribute("name")||"").replace(new RegExp("[[a-z_]+]$"),"");if(a){var l=a.match(/[a-z_]+_attributes(?=\]\[(new_)?\d+\])/g)||[],h=a.match(/[0-9]+/g)||[];for(i=0;i<l.length;i++)h[i]&&(r=r.replace(new RegExp("(_"+l[i]+")_.+?_","g"),"$1_"+h[i]+"_"),r=r.replace(new RegExp("(\\["+l[i]+"\\])\\[.+?\\]","g"),"$1["+h[i]+"]"))}var u=new RegExp("new_"+n,"g"),d=(new Date).getTime();r=r.replace(u,d);var c;return c=s?$$(s)[0].insert(r):e.insert({before:r}),c.fire("nested:fieldAdded",{field:c}),c.fire("nested:fieldAdded:"+n,{field:c}),!1}}),document.observe("click",function(t,e){if(e=t.findElement("form a.remove_nested_fields")){var i=e.previous(0),n=e.readAttribute("data-association");i&&(i.value="1");var s=e.up(".fields").hide();return s.fire("nested:fieldRemoved",{field:s}),s.fire("nested:fieldRemoved:"+n,{field:s}),!1}});